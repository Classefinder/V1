<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Classefinder | Lycée Lachenal test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css"/>
    <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@maplibre/maplibre-gl-leaflet@0.0.22/leaflet-maplibre-gl.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search@4.0.0/dist/leaflet-search.min.css"/>
    <link rel="stylesheet" href="LyceeLachenal.css" />
    <script src="https://unpkg.com/leaflet-search@4.0.0/dist/leaflet-search.min.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>

    <style>
      #map {
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <button id="dark-mode-toggle"></button>

    <script>
      // --- 1. Initialisation des limites ---
      var sudOuest = L.latLng(45.93818505744445, 6.134245788738398);
      var nordEst = L.latLng(45.93640970079779, 6.13115811037474);
      var limites = L.latLngBounds(sudOuest, nordEst);

      // --- 2. Création de la carte ---
      var map = L.map("map", {
        center: [45.9368, 6.1322],
        zoom: 18,
        minZoom: 17,
        maxZoom: 23,
        maxBounds: limites,
        maxBoundsViscosity: 1.0,
      });

      // Créez uniquement une fois les deux panes, dans l'ordre souhaité :
      map.createPane("routePane");
      map.getPane("routePane").style.zIndex = 600; // Pane pour les itinéraires

      map.createPane("arrowPane");
      map.getPane("arrowPane").style.zIndex = 650; // Pane pour les flèches

      // Assurez-vous que le pane "arrowPane" est le dernier enfant dans le conteneur
      map.getPane("arrowPane").parentNode.appendChild(map.getPane("arrowPane"));

      // --- 3. Tuiles vectorielles MapTiler ---
      // Calque clair
      var lightMap = L.maplibreGL({
        style:
          "https://api.maptiler.com/maps/3b544fc3-420c-4a93-a594-a99b71d941bb/style.json?key=BiyHHi8FTQZ233ADqskZ",
        attribution:
          '&copy; <a href="https://www.maptiler.com/copyright/" target="_blank">MapTiler</a> contributors',
      });

      // Calque sombre
      var darkMap = L.maplibreGL({
        style:
          "https://api.maptiler.com/maps/04c03a5d-804b-4c6f-9736-b7103fdb530b/style.json?key=BiyHHi8FTQZ233ADqskZ",
        attribution:
          '&copy; <a href="https://www.maptiler.com/copyright/" target="_blank">MapTiler</a> contributors',
      });

      // --- 4. Ajout du fond clair par défaut ---
      lightMap.addTo(map);

    // --- 2. Données GeoJSON pour les salles et les chemins ---
    var salleEtage0 = {
        "type": "FeatureCollection",
        "features": [
        { "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132443855592967, 45.936792791783532 ], [ 6.132451800410498, 45.936862076107261 ], [ 6.132332645198166, 45.936867696926917 ], [ 6.132323764318674, 45.936798784599809 ], [ 6.132443855592967, 45.936792791783532 ] ] ] ] } },
        { "type": "Feature", "properties": { "name": "14" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132323764318674, 45.93679878003244 ], [ 6.132332645193752, 45.936867696937178 ], [ 6.132169440848435, 45.936875476859768 ], [ 6.132160492656691, 45.936806544549889 ], [ 6.132323764318674, 45.93679878003244 ] ] ] ] } },
       ]
    };

    var salleEtage1 = {
        "type": "FeatureCollection",
        "features": [
        { "type": "Feature", "properties": { "name": "117" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132443855592967, 45.936792791783532 ], [ 6.132451800410498, 45.936862076107261 ], [ 6.132332645198166, 45.936867696926917 ], [ 6.132323764318674, 45.936798784599809 ], [ 6.132443855592967, 45.936792791783532 ] ] ] ] } },
        { "type": "Feature", "properties": { "name": "115" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132323764318674, 45.93679878003244 ], [ 6.132332645193752, 45.936867696937178 ], [ 6.132169440848435, 45.936875476859768 ], [ 6.132160492656691, 45.936806544549889 ], [ 6.132323764318674, 45.93679878003244 ] ] ] ] } },
        ]
    };

    var salleEtage2 = {
        "type": "FeatureCollection",
"features": [
{ "type": "Feature", "properties": { "name": "V1" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132559263481, 45.937761742137447 ], [ 6.132605358389325, 45.937758765489001 ], [ 6.132614138371865, 45.937824175393722 ], [ 6.132567165465287, 45.937827991605154 ], [ 6.132559263481, 45.937761742137447 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V2" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132607553384967, 45.937773801378285 ], [ 6.132725973399444, 45.93776700851511 ], [ 6.132730253640932, 45.937817306212494 ], [ 6.132614138371868, 45.937824175393722 ], [ 6.132607553384967, 45.937773801378285 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R11" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132443855592967, 45.936792791783532 ], [ 6.132451800410498, 45.936862076107261 ], [ 6.132332645198166, 45.936867696926917 ], [ 6.132323764318674, 45.936798784599809 ], [ 6.132443855592967, 45.936792791783532 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R12" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132323764318674, 45.93679878003244 ], [ 6.132332645193752, 45.936867696937178 ], [ 6.132169440848435, 45.936875476859768 ], [ 6.132160492656691, 45.936806544549889 ], [ 6.132323764318674, 45.93679878003244 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R9" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132338097023253, 45.936716667911078 ], [ 6.132346542802771, 45.936781465154866 ], [ 6.132227172282988, 45.936787083013414 ], [ 6.132219251901891, 45.936722066542458 ], [ 6.132338097023253, 45.936716667911078 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R8" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132219253543763, 45.936722064258774 ], [ 6.132227180492344, 45.936787079587916 ], [ 6.132107560408311, 45.936792893842551 ], [ 6.132099429867845, 45.936727498286743 ], [ 6.132219253543763, 45.936722064258774 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R7" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132099431509721, 45.936727500570427 ], [ 6.132116122760606, 45.936862250362864 ], [ 6.132020322927197, 45.936866941039654 ], [ 6.132004120953585, 45.936731824727232 ], [ 6.132099431509721, 45.936727500570427 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R6" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132116189227633, 45.936862186893528 ], [ 6.132124696936733, 45.936927733982991 ], [ 6.132030014367759, 45.936932969021719 ], [ 6.132034131001193, 45.936967051293124 ], [ 6.131986299641299, 45.936969668810697 ], [ 6.131974067359097, 45.936869957663198 ], [ 6.132020328027306, 45.936866941377744 ], [ 6.132116189227633, 45.936862186893528 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R5" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132038113848223, 45.936998476904492 ], [ 6.132133756964997, 45.936993473628341 ], [ 6.132151611175407, 45.937134784331924 ], [ 6.132055007510834, 45.937140237480925 ], [ 6.132038113848223, 45.936998476904492 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V18" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132302978019801, 45.937163950166401 ], [ 6.132305228465431, 45.937189553478937 ], [ 6.132287198591141, 45.937205146048541 ], [ 6.13226320449913, 45.937221778117973 ], [ 6.132204028302615, 45.937188433835416 ], [ 6.132202875929909, 45.937181011218328 ], [ 6.132226636757653, 45.937179541959814 ], [ 6.132225100260709, 45.93716845573524 ], [ 6.132302978019801, 45.937163950166401 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132429212643101, 45.936677276337036 ], [ 6.132434054588134, 45.936712841350747 ], [ 6.132395279821793, 45.936744510723749 ], [ 6.132342136044464, 45.936747360012134 ], [ 6.132338097823097, 45.936716658581339 ], [ 6.132385145062337, 45.936678840720951 ], [ 6.132429212643101, 45.936677276337036 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Sanitaire" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132322925088437, 45.936918998692519 ], [ 6.132327943460623, 45.936952494757485 ], [ 6.132285071663862, 45.936986031700897 ], [ 6.132232463785305, 45.936988325741943 ], [ 6.132229085449164, 45.936950899707192 ], [ 6.132270918286057, 45.936921370819881 ], [ 6.132322925088437, 45.936918998692519 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V16" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132517020961398, 45.937206389313879 ], [ 6.132524758321008, 45.937254092469317 ], [ 6.13251274071991, 45.937254970206972 ], [ 6.132515978338468, 45.937274356757314 ], [ 6.132441554267732, 45.937278955337604 ], [ 6.132430647883178, 45.937212151857189 ], [ 6.132517020961398, 45.937206389313879 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13215159180801, 45.937134835398332 ], [ 6.132163770367505, 45.937229463372603 ], [ 6.132067401939128, 45.93723538001754 ], [ 6.132055053263787, 45.937140213042852 ], [ 6.13215159180801, 45.937134835398332 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132124809654063, 45.936927665818267 ], [ 6.132129592790053, 45.936961966219414 ], [ 6.132034184909476, 45.936967024027155 ], [ 6.132030019268502, 45.936932969021555 ], [ 6.132124809654063, 45.936927665818267 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Adjoint" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132127490366544, 45.937332306272104 ], [ 6.132086245620142, 45.93736513407989 ], [ 6.132037159667203, 45.937368187828461 ], [ 6.132032611767408, 45.937336232522568 ], [ 6.132076130463709, 45.937303254736648 ], [ 6.132127490366544, 45.937332306272104 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Coordinateur secteurs" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132138673887373, 45.937393728884139 ], [ 6.132143378611296, 45.937427101967195 ], [ 6.132192150915976, 45.937424484471208 ], [ 6.132237002617387, 45.937389093732136 ], [ 6.132232297893465, 45.93738816670168 ], [ 6.132208382213516, 45.937374043118204 ], [ 6.132182092065031, 45.937359878840439 ], [ 6.132138673887373, 45.937393728884139 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132257849899189, 45.9373207431655 ], [ 6.132265525705262, 45.937386943240583 ], [ 6.13223712023548, 45.937388848341719 ], [ 6.132236983014368, 45.937389039200923 ], [ 6.132232337099492, 45.93738816670168 ], [ 6.132208441022562, 45.937374084016618 ], [ 6.132231729405984, 45.937355952383939 ], [ 6.132206212152012, 45.937339523948609 ], [ 6.132226403539401, 45.937323281053075 ], [ 6.132257849899189, 45.9373207431655 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132308071095699, 45.9372562104884 ], [ 6.132359433993545, 45.937284221761089 ], [ 6.132264665057027, 45.937290747546015 ], [ 6.132308071095699, 45.9372562104884 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Dessin GC - R3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132257959648957, 45.937320732088672 ], [ 6.132446383258118, 45.937308855641085 ], [ 6.132457385673736, 45.937376307766222 ], [ 6.132265644031364, 45.937386943240483 ], [ 6.132257959648957, 45.937320732088672 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V14" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132680458377678, 45.937160127816881 ], [ 6.13268444425343, 45.93719371934894 ], [ 6.132714735193187, 45.937212495320104 ], [ 6.132678298265654, 45.937241498840308 ], [ 6.132656787308436, 45.937230050084146 ], [ 6.132606247533951, 45.937268403407998 ], [ 6.13259702794009, 45.937201523971432 ], [ 6.132645770840243, 45.937162152296104 ], [ 6.132680458377678, 45.937160127816881 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V13" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132704391276252, 45.937255409075881 ], [ 6.132680520698729, 45.937275558875939 ], [ 6.132709140526577, 45.93729225019387 ], [ 6.132747029066454, 45.937289907971518 ], [ 6.13274682438953, 45.937282925639479 ], [ 6.132787441839407, 45.937250643096419 ], [ 6.132783834884398, 45.937219560224705 ], [ 6.132734572504311, 45.937222835514987 ], [ 6.132714707755736, 45.937212514401381 ], [ 6.132678380577984, 45.937241479759059 ], [ 6.132704391276252, 45.937255409075881 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R2 STS Bâtiment" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132517459296714, 45.937399871311889 ], [ 6.132565327156417, 45.937362287844401 ], [ 6.132610983065614, 45.937391062311796 ], [ 6.132628543030697, 45.937553843848384 ], [ 6.132534726793107, 45.937558629070274 ], [ 6.132517459296714, 45.937399871311889 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "R1 STS Bâtiment" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132628529311978, 45.937553834307799 ], [ 6.132643661063136, 45.937693851615414 ], [ 6.132550702998013, 45.937698087621293 ], [ 6.13253499115222, 45.937558968042602 ], [ 6.132628529311978, 45.937553834307799 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V11" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132751257005316, 45.937338674833427 ], [ 6.132755976245933, 45.937394124845142 ], [ 6.132697040613148, 45.937397597624489 ], [ 6.13269594311533, 45.937385843601234 ], [ 6.132667572796755, 45.93738767539724 ], [ 6.132661317059195, 45.937344361038136 ], [ 6.132751257005316, 45.937338674833427 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "EDF" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132512071074854, 45.937730029374599 ], [ 6.132555092989289, 45.937728502887367 ], [ 6.13256720738637, 45.937827850296451 ], [ 6.132523666101738, 45.937830593630423 ], [ 6.132512071074854, 45.937730029374599 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132773728273156, 45.937548854127066 ], [ 6.132780519040903, 45.937611106352279 ], [ 6.132713695142558, 45.937614226117127 ], [ 6.132712529051139, 45.937605610986267 ], [ 6.132686367446902, 45.937606402853248 ], [ 6.132683733452141, 45.937583734462919 ], [ 6.132729389361338, 45.937550151645418 ], [ 6.132773728273156, 45.937548854127066 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V10" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132697726549297, 45.93740776790564 ], [ 6.132697095488052, 45.937397559462106 ], [ 6.132755839058721, 45.937394086682787 ], [ 6.132760651254606, 45.937446578535969 ], [ 6.132675611968283, 45.937451482920103 ], [ 6.132670069604303, 45.937409294401711 ], [ 6.132697726549297, 45.93740776790564 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V9" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13267621559208, 45.937451425676542 ], [ 6.132760585736782, 45.937446559973907 ], [ 6.132766923786677, 45.937515595668145 ], [ 6.132726096867875, 45.937517427459859 ], [ 6.132681757956058, 45.937491171772862 ], [ 6.13267621559208, 45.937451425676542 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V8" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132844544319799, 45.937441866001585 ], [ 6.13285080005736, 45.937494339247479 ], [ 6.132837410583988, 45.937495274224858 ], [ 6.132838508081803, 45.937513573064813 ], [ 6.132766951224119, 45.937515557505897 ], [ 6.132760530861888, 45.937446521811594 ], [ 6.132844544319799, 45.937441866001585 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13289620121191, 45.937439206606143 ], [ 6.132947639526813, 45.937436534579568 ], [ 6.132953049959326, 45.937481250109293 ], [ 6.13290114117203, 45.937483758540381 ], [ 6.13289620121191, 45.937439206606143 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V6" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132869841644498, 45.93754551492529 ], [ 6.132917198675309, 45.937544942490668 ], [ 6.132922905663959, 45.937602643869987 ], [ 6.132863777969059, 45.93760583041928 ], [ 6.132859305665451, 45.937565092185501 ], [ 6.132870609892968, 45.937564596075688 ], [ 6.132869841644498, 45.93754551492529 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132533074937031, 45.937322475733509 ], [ 6.132581788432659, 45.937349455071761 ], [ 6.132538436362003, 45.93738344165758 ], [ 6.132492075228335, 45.937357041730223 ], [ 6.132533074937031, 45.937322475733509 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13255515773495, 45.937728684477079 ], [ 6.132559181168663, 45.937761952029298 ], [ 6.132631923146978, 45.93775698599061 ], [ 6.132629021900557, 45.937723394982591 ], [ 6.13255515773495, 45.937728684477079 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132206184714567, 45.937339523948609 ], [ 6.132182146939924, 45.93735989792166 ], [ 6.132208419581737, 45.937373987308597 ], [ 6.132231707965161, 45.937355937472724 ], [ 6.132206184714567, 45.937339523948609 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132109463555203, 45.937346721693224 ], [ 6.132161450754563, 45.937376713869369 ], [ 6.132138476019402, 45.937393727605723 ], [ 6.132086175171779, 45.937365098719432 ], [ 6.132109463555203, 45.937346721693224 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132287223707468, 45.937205158402804 ], [ 6.132336936956933, 45.937233187526743 ], [ 6.132293748749182, 45.937267697401651 ], [ 6.132240725352684, 45.93723885878746 ], [ 6.132263249218473, 45.937221735940867 ], [ 6.132287223707468, 45.937205158402804 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V21" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132285143680348, 45.936985997817807 ], [ 6.132179509515824, 45.936990768154132 ], [ 6.132184863246976, 45.937033732169844 ], [ 6.132203434968155, 45.937032747096147 ], [ 6.132205190964656, 45.937042516736291 ], [ 6.132290356794962, 45.937038242518945 ], [ 6.132285143680348, 45.936985997817807 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V20" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132290353365288, 45.937038240133788 ], [ 6.132205221831484, 45.937042509580856 ], [ 6.132206840640763, 45.93705450219344 ], [ 6.132187510960462, 45.937055427637596 ], [ 6.132194596680746, 45.937113487300728 ], [ 6.132297658585135, 45.937108836233037 ], [ 6.132290353365288, 45.937038240133788 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V19" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132297548835356, 45.937108759907822 ], [ 6.132303008886997, 45.937163923930186 ], [ 6.132225086541987, 45.937168436653955 ], [ 6.132223632357366, 45.937158848308158 ], [ 6.132200324247481, 45.937160832761975 ], [ 6.132194589821385, 45.937113492071049 ], [ 6.132297548835356, 45.937108759907822 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Chef des travaux" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132076224681802, 45.937303264838846 ], [ 6.132127422954976, 45.937332344636481 ], [ 6.132176974981426, 45.937292350370178 ], [ 6.132125831583141, 45.937264110126598 ], [ 6.132071615190971, 45.937267315776587 ], [ 6.132076224681802, 45.937303264838846 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132125804145699, 45.937264110126598 ], [ 6.132172118553585, 45.937261267020205 ], [ 6.13217705729376, 45.937292369451427 ], [ 6.132125804145699, 45.937264110126598 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "GC Profs" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132446410695565, 45.937308836559879 ], [ 6.13247291526785, 45.937306966598811 ], [ 6.132520766172685, 45.937332611773769 ], [ 6.13249209404221, 45.937356997576451 ], [ 6.132467702153222, 45.93737562084263 ], [ 6.13245744054863, 45.937376288685044 ], [ 6.132446410695565, 45.937308836559879 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V17" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132308119111237, 45.937256215258714 ], [ 6.132359433993552, 45.937284193139213 ], [ 6.132441554267731, 45.937278964878224 ], [ 6.132430689039342, 45.937212180479086 ], [ 6.132359241931439, 45.937215767757429 ], [ 6.132308119111237, 45.937256215258714 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V15" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132517130711181, 45.937206389313886 ], [ 6.13259724805184, 45.937201466345925 ], [ 6.132606302408835, 45.937268517895475 ], [ 6.132539135542419, 45.937272639445091 ], [ 6.132536172298312, 45.937253634519237 ], [ 6.132524785758457, 45.937254054306834 ], [ 6.132517130711181, 45.937206389313886 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132680575573622, 45.93727553979469 ], [ 6.132709154245301, 45.937292259734491 ], [ 6.13265423562601, 45.93729568958743 ], [ 6.132680575573622, 45.93727553979469 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13274730344091, 45.93728988889027 ], [ 6.132748949687636, 45.937307672604646 ], [ 6.132656540371424, 45.93731332065007 ], [ 6.132654564875353, 45.93729568958743 ], [ 6.13274730344091, 45.93728988889027 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "VDI0" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132748719041615, 45.937307648753091 ], [ 6.132751462786156, 45.937338560346042 ], [ 6.13266124846558, 45.937344361038107 ], [ 6.132656529224967, 45.93731322047357 ], [ 6.132748719041615, 45.937307648753091 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V7" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132844654069588, 45.937441866001564 ], [ 6.132896181592108, 45.937439270959757 ], [ 6.132903644577266, 45.937511474136642 ], [ 6.132865012654101, 45.937513305928498 ], [ 6.132863146907809, 45.937493919461708 ], [ 6.132850800057366, 45.93749426292279 ], [ 6.132844654069588, 45.937441866001564 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V5" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132859333102897, 45.937565073104345 ], [ 6.132863723094168, 45.93760583041928 ], [ 6.132780532759623, 45.93761113497397 ], [ 6.132773728273158, 45.937548930451669 ], [ 6.132842870635642, 45.937546946011778 ], [ 6.132845065631278, 45.937565340240411 ], [ 6.132859333102897, 45.937565073104345 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "V3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132780738540482, 45.937611144514577 ], [ 6.13278578703044, 45.937672356749367 ], [ 6.132694914211173, 45.937674951780274 ], [ 6.132688987722962, 45.937628241205417 ], [ 6.132715547170139, 45.937627172662388 ], [ 6.132713818611077, 45.937614216576598 ], [ 6.132780738540482, 45.937611144514577 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Sanitaire" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132786033967446, 45.937672051451607 ], [ 6.1327869119657, 45.937680141841703 ], [ 6.132835860368347, 45.937707771278284 ], [ 6.132840030860055, 45.937737843080349 ], [ 6.132792179955223, 45.937742269892468 ], [ 6.132736207566544, 45.937710518956308 ], [ 6.132734890569162, 45.937691285207293 ], [ 6.132762547514156, 45.937690979909625 ], [ 6.132761587203566, 45.937673081831548 ], [ 6.132786033967446, 45.937672051451607 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.132395173838695, 45.936744396442087 ], [ 6.132401429576253, 45.936794771392712 ], [ 6.132443902741779, 45.936792786925814 ], [ 6.132440939497673, 45.936772636950352 ], [ 6.132395173838695, 45.936744396442087 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M16" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131321063051216, 45.936668955722908 ], [ 6.131325229189177, 45.93670978205099 ], [ 6.131416765868066, 45.936704645837175 ], [ 6.131411771236763, 45.936663161015851 ], [ 6.131321063051216, 45.936668955722908 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M16 Prof" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131411747565526, 45.936663095166914 ], [ 6.131416860553021, 45.936704448290484 ], [ 6.131473860895087, 45.936701024147652 ], [ 6.1314689372775, 45.936659934417335 ], [ 6.131411747565526, 45.936663095166914 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M13" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131468747907593, 45.936659934417335 ], [ 6.131556236804714, 45.936654666500992 ], [ 6.131563468368054, 45.936724013640955 ], [ 6.13147702389035, 45.936728809161316 ], [ 6.131468747907593, 45.936659934417335 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M12" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131556142119761, 45.936654534803075 ], [ 6.131639748933784, 45.936650320469631 ], [ 6.131646767455979, 45.936717626299711 ], [ 6.131563468368054, 45.936724013640955 ], [ 6.131556142119761, 45.936654534803075 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M11 Prof" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131639760769411, 45.936650394549716 ], [ 6.131725545337366, 45.93664552172627 ], [ 6.13173501383273, 45.936712029144374 ], [ 6.13164676745598, 45.936717560450816 ], [ 6.131639760769411, 45.936650394549716 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M14" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131325683505474, 45.936709682089287 ], [ 6.131335684619343, 45.93680357856131 ], [ 6.131422458989679, 45.936800510051661 ], [ 6.131416281831114, 45.936704363330136 ], [ 6.131325683505474, 45.936709682089287 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M9" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131478641717591, 45.936754891521595 ], [ 6.131612186002786, 45.936745890551585 ], [ 6.131641637812375, 45.936989491572547 ], [ 6.131501732524612, 45.936999157344424 ], [ 6.131478641717591, 45.936754891521595 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M20" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131613362604418, 45.936745890551585 ], [ 6.131712785442293, 45.936739344390666 ], [ 6.131726316361059, 45.93685185642402 ], [ 6.131626893523181, 45.93685758430324 ], [ 6.131613362604418, 45.936745890551585 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M19" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131726022210652, 45.93685185642402 ], [ 6.131741612182271, 45.936982983796639 ], [ 6.131641601043579, 45.936989529928802 ], [ 6.13162647068197, 45.936857635445008 ], [ 6.131726022210652, 45.93685185642402 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M18" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131835630006401, 45.936707981620678 ], [ 6.131709880707017, 45.936713402663308 ], [ 6.131726206054653, 45.93685158792966 ], [ 6.131814451177029, 45.936843507527563 ], [ 6.13181224504897, 45.936817220641693 ], [ 6.131849896301183, 45.936814356700076 ], [ 6.131835630006401, 45.936707981620678 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M17" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131741648951069, 45.936982715302918 ], [ 6.131812006051716, 45.936978099767579 ], [ 6.131810535299676, 45.936961325299038 ], [ 6.131865835576364, 45.936957643097877 ], [ 6.131852837805264, 45.936841155005204 ], [ 6.131814304101826, 45.936843405243991 ], [ 6.131726353129859, 45.936851690213231 ], [ 6.131741648951069, 45.936982715302918 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M5 Prof" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131343075148331, 45.936932059464809 ], [ 6.131293216654189, 45.936934514266696 ], [ 6.131299099662348, 45.937003760092352 ], [ 6.131322631694982, 45.937002532692951 ], [ 6.131319543115696, 45.936979518949045 ], [ 6.131349105231694, 45.936977575565777 ], [ 6.131343075148331, 45.936932059464809 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M6" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131293510804598, 45.936934411983287 ], [ 6.131220708578639, 45.936939117019975 ], [ 6.131226444511591, 45.937008260556603 ], [ 6.131299173199946, 45.937003606667425 ], [ 6.131293510804598, 45.936934411983287 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M7" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131220708578635, 45.936938912453172 ], [ 6.13098803560597, 45.936952822994158 ], [ 6.130993330313314, 45.937024625878095 ], [ 6.131226297436386, 45.937007646856955 ], [ 6.131220708578635, 45.936938912453172 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M8" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131097753708123, 45.937073619530459 ], [ 6.131091870699966, 45.937017159200764 ], [ 6.130993624463719, 45.937024114461884 ], [ 6.130999507471879, 45.937078119989039 ], [ 6.131097753708123, 45.937073619530459 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M1.4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131098047858534, 45.937073619530445 ], [ 6.131227768188426, 45.937066868841882 ], [ 6.131235121948622, 45.937154832295136 ], [ 6.131109225574034, 45.937161992104954 ], [ 6.131098047858534, 45.937073619530445 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M1.3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131109519724442, 45.93716158297299 ], [ 6.13112334479361, 45.937277980895296 ], [ 6.131245417212899, 45.937271230231595 ], [ 6.131235195486223, 45.937154883436634 ], [ 6.131109519724442, 45.93716158297299 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131444557039057, 45.937029586615957 ], [ 6.131447939768749, 45.937057305364974 ], [ 6.131476178207909, 45.937055668834013 ], [ 6.131485002720146, 45.937121948299549 ], [ 6.131674435582846, 45.937111310859805 ], [ 6.131663993243365, 45.937016903491845 ], [ 6.131444557039057, 45.937029586615957 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131687966501611, 45.937005754616301 ], [ 6.131696791013846, 45.937100673418001 ], [ 6.131810627221713, 45.93709412729897 ], [ 6.131798272904579, 45.936999617619215 ], [ 6.131687966501611, 45.937005754616301 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131810627221713, 45.937094025015845 ], [ 6.131824746441291, 45.9372026495789 ], [ 6.131708998255776, 45.937209400250921 ], [ 6.131696938089048, 45.937100468851796 ], [ 6.131810627221713, 45.937094025015845 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2.1 Prof" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131824672903684, 45.937202649578886 ], [ 6.131829452847815, 45.937235686950849 ], [ 6.131712380985462, 45.93724274446739 ], [ 6.131709016640171, 45.937209400250914 ], [ 6.131824672903684, 45.937202649578886 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2.2" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131677873465708, 45.937132956513189 ], [ 6.131603196030921, 45.937136894410337 ], [ 6.131613197144791, 45.937228949067368 ], [ 6.131687617197994, 45.937224857752526 ], [ 6.131677873465708, 45.937132956513189 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2.3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131603343106127, 45.937136894410337 ], [ 6.131517892412626, 45.937141906278931 ], [ 6.131529364278535, 45.937255133475212 ], [ 6.131569074583604, 45.937253292384447 ], [ 6.131567309681157, 45.937231403856131 ], [ 6.131613197144793, 45.9372288467845 ], [ 6.131603343106127, 45.937136894410337 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2.4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131518113025429, 45.937141906278917 ], [ 6.131395305230124, 45.937149168373416 ], [ 6.131405747569606, 45.937262242130679 ], [ 6.131529364278531, 45.937255184616625 ], [ 6.131518113025429, 45.937141906278917 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M2.5" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131475975979493, 45.937055732760932 ], [ 6.131487594920604, 45.937143491665829 ], [ 6.131395525842927, 45.937149219514929 ], [ 6.131387216093901, 45.937061204911181 ], [ 6.131475975979493, 45.937055732760932 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131319561500078, 45.936979634017725 ], [ 6.131349050078472, 45.936977639492795 ], [ 6.131352506345766, 45.93700310803635 ], [ 6.131322944229771, 45.937004795710514 ], [ 6.131319561500078, 45.936979634017725 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E1" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131906612176676, 45.937262855827512 ], [ 6.131727768728664, 45.937272470410328 ], [ 6.131740711346612, 45.937379458102406 ], [ 6.131919260644218, 45.937369434407707 ], [ 6.131906612176676, 45.937262855827512 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E2" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131741593797835, 45.937379458102406 ], [ 6.131919260644218, 45.937369638972925 ], [ 6.131934850615837, 45.937490332318831 ], [ 6.131755713017416, 45.937498719473787 ], [ 6.131741593797835, 45.937379458102406 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131755860092619, 45.937498668332587 ], [ 6.131758286833485, 45.937521221590551 ], [ 6.131824323600064, 45.937517028014931 ], [ 6.131821676246392, 45.937495753284971 ], [ 6.131755860092619, 45.937498668332587 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131821823321594, 45.937495548720221 ], [ 6.131888742539396, 45.937492684813627 ], [ 6.131891389893068, 45.93751293672134 ], [ 6.131824176524859, 45.937516823450252 ], [ 6.131821823321594, 45.937495548720221 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": null }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131889036689804, 45.937492480248871 ], [ 6.13193463000303, 45.937490230036431 ], [ 6.131935806604663, 45.93751048194504 ], [ 6.131891095742659, 45.937512732156648 ], [ 6.131889036689804, 45.937492480248871 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E4" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131745344215538, 45.937409529175625 ], [ 6.131640479595114, 45.937415052432186 ], [ 6.131653716363471, 45.937527767659169 ], [ 6.131758139758283, 45.937521017025894 ], [ 6.131745344215538, 45.937409529175625 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E5" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131692250066907, 45.937377207885376 ], [ 6.131696662323025, 45.937411983956387 ], [ 6.131641067895929, 45.9374150524322 ], [ 6.131653863438673, 45.93752746081222 ], [ 6.131581502438326, 45.937532472645515 ], [ 6.131565618316297, 45.937383549405816 ], [ 6.131692250066907, 45.937377207885376 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E3" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131679307448958, 45.937275232045486 ], [ 6.131692250066904, 45.937377182314705 ], [ 6.131596687953134, 45.937381912884462 ], [ 6.131593746449054, 45.937360331254787 ], [ 6.131563301881834, 45.937361763211527 ], [ 6.131554771520002, 45.937281982708683 ], [ 6.131679307448958, 45.937275232045486 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E8" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131566243385912, 45.937383549405787 ], [ 6.131428875145414, 45.937393163967677 ], [ 6.131448289072332, 45.937540246100312 ], [ 6.131582127507937, 45.937532268080851 ], [ 6.131566243385912, 45.937383549405787 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E6" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131520061771864, 45.937286176302067 ], [ 6.131529474584918, 45.937363297450823 ], [ 6.131500059544125, 45.937364933972724 ], [ 6.13150211859698, 45.937387640708941 ], [ 6.131476527511492, 45.937389686360405 ], [ 6.13146123169028, 45.937291085874413 ], [ 6.131520061771864, 45.937286176302067 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E7" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131460937539871, 45.937291290439916 ], [ 6.131440641161725, 45.937291699570935 ], [ 6.131443288515397, 45.937313383510023 ], [ 6.131419462332357, 45.937315224598805 ], [ 6.131429463446223, 45.937393163967698 ], [ 6.131475939210675, 45.937389686360405 ], [ 6.131460937539871, 45.937291290439916 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E9" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131421227234805, 45.937324430041762 ], [ 6.131377692974433, 45.937327498522421 ], [ 6.131373280718313, 45.937298245666618 ], [ 6.131332393811611, 45.93730110958326 ], [ 6.131335629466101, 45.937330976133616 ], [ 6.13129327180736, 45.937334249179251 ], [ 6.131319451193662, 45.937548019554029 ], [ 6.131448289072331, 45.937539836971112 ], [ 6.131421227234805, 45.937324430041762 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E10 Entretien atelier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131206203286613, 45.937310724159452 ], [ 6.131214439498033, 45.937380071797882 ], [ 6.13129827236429, 45.937374343972628 ], [ 6.131289447852054, 45.937303973499738 ], [ 6.131206203286613, 45.937310724159452 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E11" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131214733648442, 45.93737976495013 ], [ 6.13121870467895, 45.937414438737001 ], [ 6.13130268462041, 45.93740912004543 ], [ 6.131298125289089, 45.937374446255234 ], [ 6.131214733648442, 45.93737976495013 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "M1" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131419315257151, 45.937059005822782 ], [ 6.131415932527457, 45.937032616755481 ], [ 6.131268857323496, 45.937040594847915 ], [ 6.131292095205723, 45.937267663119087 ], [ 6.131405637263179, 45.937261526150991 ], [ 6.131386223336255, 45.937060642353657 ], [ 6.131419315257151, 45.937059005822782 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131604188788524, 45.937229102491585 ], [ 6.131607130292603, 45.937249559061229 ], [ 6.131690448395623, 45.937245007475042 ], [ 6.131687433353942, 45.937224908893782 ], [ 6.131604188788524, 45.937229102491585 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131529364278503, 45.937363144026399 ], [ 6.131532342551374, 45.937385901905053 ], [ 6.131502228903363, 45.937387998697858 ], [ 6.131500096312905, 45.937364933972624 ], [ 6.131529364278503, 45.937363144026399 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131730673463924, 45.937296506860008 ], [ 6.131705670679251, 45.937297938818382 ], [ 6.131710965386594, 45.93734273864046 ], [ 6.131736262321674, 45.937341102117912 ], [ 6.131730673463924, 45.937296506860008 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131613454526369, 45.936991396599005 ], [ 6.131615513579224, 45.937004284293998 ], [ 6.131567567062732, 45.937008784758213 ], [ 6.131565802160285, 45.936994874231274 ], [ 6.131613454526369, 45.936991396599005 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131810829450081, 45.936960916165546 ], [ 6.131811417750898, 45.936977486067683 ], [ 6.131868188779626, 45.936976258667691 ], [ 6.131865835576363, 45.936957643097877 ], [ 6.131810829450081, 45.936960916165546 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131812594352531, 45.936817310139695 ], [ 6.131815682931813, 45.936843085607627 ], [ 6.131852157582395, 45.93684093765242 ], [ 6.131849216078318, 45.936814446198099 ], [ 6.131812594352531, 45.936817310139695 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Escalier" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131209291865886, 45.937333942331172 ], [ 6.131191054540595, 45.937335169723255 ], [ 6.131194878495899, 45.937365854516194 ], [ 6.131212527520374, 45.937364627124786 ], [ 6.131209291865886, 45.937333942331172 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E17" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131123988247589, 45.937277482266559 ], [ 6.131134577662275, 45.937346011685371 ], [ 6.130948674604468, 45.937358490167441 ], [ 6.130941026693864, 45.937289347067534 ], [ 6.131123988247589, 45.937277482266559 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E14" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131048391592753, 45.937351330382995 ], [ 6.131068687970898, 45.937503322179865 ], [ 6.130968088531391, 45.937508640863122 ], [ 6.1309498512061, 45.937358081036926 ], [ 6.131048391592753, 45.937351330382995 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E13" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13105162724724, 45.937374037124769 ], [ 6.131164286853474, 45.937365854516194 ], [ 6.131171934764081, 45.937417814060176 ], [ 6.131058392706623, 45.93742517840105 ], [ 6.13105162724724, 45.937374037124769 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Entretien" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131373427793505, 45.937298245666568 ], [ 6.131416373753059, 45.93729466577058 ], [ 6.131420638933975, 45.937324327759015 ], [ 6.131377398824013, 45.937327293956997 ], [ 6.131373427793505, 45.937298245666568 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "Magasin" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131332687962008, 45.93730110958321 ], [ 6.131289742002451, 45.937303973499695 ], [ 6.131293565957754, 45.937334044613863 ], [ 6.131335188240474, 45.93733087385089 ], [ 6.131332687962008, 45.93730110958321 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E16" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.13096764730578, 45.937500662838659 ], [ 6.130981766525358, 45.937633629755254 ], [ 6.130885873492376, 45.937639357553735 ], [ 6.130868224467902, 45.937507618039149 ], [ 6.13096764730578, 45.937500662838659 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E15" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.130971471261079, 45.93753809817207 ], [ 6.131182671253966, 45.937526847118242 ], [ 6.131194143119876, 45.937620537642253 ], [ 6.130982060675763, 45.937633629755254 ], [ 6.130971471261079, 45.93753809817207 ] ] ] ] } },
{ "type": "Feature", "properties": { "name": "E12" }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 6.131058833932231, 45.937424973836059 ], [ 6.131302978770802, 45.937409426892998 ], [ 6.13131886289283, 45.937547712707151 ], [ 6.131187671810899, 45.93755507703078 ], [ 6.131182965404371, 45.937527256247506 ], [ 6.130973530313934, 45.937537075349077 ], [ 6.130968823907406, 45.937508027168548 ], [ 6.131068246745283, 45.937502708485958 ], [ 6.131058833932231, 45.937424973836059 ] ] ] ] } }
]
    };

    var CheminEtage0 = {
        "type": "FeatureCollection",
"features":[
        {"type":"Feature","properties":{"name":"8","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13217,45.93707],[6.13212,45.93707]]}},
        {"type":"Feature","properties":{"name":"10","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.1321,45.93685],[6.13215,45.93685]]}},
        {"type":"Feature","properties":{"name":"Réunion","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13273,45.93773],[6.13269,45.93776]]}},
        {"type":"Feature","properties":{"name":"1","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13276,45.93756],[6.13276,45.93759]]}},
        {"type":"Feature","properties":{"name":"6","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13232,45.9373],[6.13232,45.93733]]}},
        {"type":"Feature","properties":{"name":"11","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13214,45.93677],[6.13215,45.9368]]}},
        {"type":"Feature","properties":{"name":"14","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13229,45.93681],[6.13228,45.93679]]}},
        {"type":"Feature","properties":{"name":"CDI","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13266,45.93761],[6.13261,45.93761]]}},
        {"type":"Feature","properties":{"name":"Proviseur","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13285,45.9375],[6.13285,45.93747]]}},
        {"type":"Feature","properties":{"name":"0","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13218,45.93707],[6.13223,45.93707]]}},
        {"type":"Feature","properties":{"name":"12","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13225,45.93677],[6.13225,45.93679]]}},
        {"type":"Feature","properties":{"name":"Acceuil","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13284,45.93754],[6.13287,45.93756]]}},
        {"type":"Feature","properties":{"name":"7","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13219,45.93717],[6.13214,45.93718]]}},
        {"type":"Feature","properties":{"name":"7.8","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13218,45.93714],[6.13213,45.93714]]}},
        {"type":"Feature","properties":{"name":"13","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13242,45.9368],[6.13242,45.93678]]}},
        {"type":"Feature","properties":{"name":"2","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13266,45.9376],[6.13272,45.93761]]}},
        {"type":"Feature","properties":{"name":"Intendance","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13264,45.9374],[6.1327,45.9374]]}},
        {"type":"Feature","properties":{"name":"Vie scolaire","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13237,45.9373],[6.13237,45.93732]]}},
        {"type":"Feature","properties":{"name":"9","foot":"yes","highway":"footway"},"geometry":{"type":"LineString","coordinates":[[6.13215,45.93687],[6.13209,45.93688]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E105","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13148,45.93734],[6.13148,45.93738]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E108","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13144,45.93741],[6.13148,45.9374]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M105","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13173,45.93679],[6.13174,45.93681]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M101","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13179,45.93695],[6.13175,45.93695]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E109 Prof","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13123,45.93737],[6.13121,45.93737]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M109","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13168,45.93699],[6.13164,45.93699]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E104","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13171,45.93743],[6.1317,45.93738]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M106","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13171,45.93721],[6.13167,45.93721]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E103","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13161,45.93736],[6.13161,45.93739]]}},
        {"type":"Feature","properties":{"bridge":"yes","foot":"yes","highway":"footway","layer":"-1","name":"M108.1"},"geometry":{"type":"LineString","coordinates":[[6.13177,45.93699],[6.13177,45.93701]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M102","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13178,45.93687],[6.13174,45.93688]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E102","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13182,45.93739],[6.13176,45.93739],[6.13175,45.93739]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M106.1","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13172,45.93724],[6.13171,45.93721]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E107","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13141,45.93737],[6.13148,45.93738]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E101","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13177,45.93735],[6.13176,45.93739]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M110","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13168,45.93726],[6.13168,45.93724]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M104 Prof","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13164,45.93686],[6.13164,45.93684]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M108","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13171,45.93704],[6.13165,45.93705]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"M103","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.1317,45.93695],[6.13175,45.93695]]}},
        {"type":"Feature","properties":{"bridge":"yes","name":"E106","highway":"footway","foot":"yes","layer":"-1"},"geometry":{"type":"LineString","coordinates":[[6.13153,45.93743],[6.13153,45.9374]]}},
      ]
    };
    var CheminEtage1 = {
      "type": "FeatureCollection",
      "features":[
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"116"},"geometry":{"type":"LineString","coordinates":[[6.13218,45.93718],[6.13214,45.93718]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"113"},"geometry":{"type":"LineString","coordinates":[[6.13216,45.93702],[6.13221,45.93701]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"106"},"geometry":{"type":"LineString","coordinates":[[6.13266,45.93757],[6.13262,45.93757]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"115"},"geometry":{"type":"LineString","coordinates":[[6.1322,45.93681],[6.1322,45.9368]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"Audio visuel"},"geometry":{"type":"LineString","coordinates":[[6.13275,45.93753],[6.13275,45.93756]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"101"},"geometry":{"type":"LineString","coordinates":[[6.13267,45.93766],[6.13273,45.93766]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"103"},"geometry":{"type":"LineString","coordinates":[[6.13263,45.93739],[6.13269,45.93738]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"108"},"geometry":{"type":"LineString","coordinates":[[6.13265,45.9375],[6.13259,45.93751]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"109"},"geometry":{"type":"LineString","coordinates":[[6.1324,45.9373],[6.13239,45.93727]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"Labo"},"geometry":{"type":"LineString","coordinates":[[6.13215,45.93687],[6.1321,45.93687]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"118"},"geometry":{"type":"LineString","coordinates":[[6.13217,45.93708],[6.13211,45.93708]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"117"},"geometry":{"type":"LineString","coordinates":[[6.13242,45.93678],[6.13242,45.9368]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"104"},"geometry":{"type":"LineString","coordinates":[[6.13266,45.9376],[6.13261,45.9376]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"114"},"geometry":{"type":"LineString","coordinates":[[6.13235,45.9373],[6.13235,45.93733]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"Video lecture"},"geometry":{"type":"LineString","coordinates":[[6.13274,45.93753],[6.13273,45.9375]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"124"},"geometry":{"type":"LineString","coordinates":[[6.13224,45.93678],[6.13224,45.93679]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"110"},"geometry":{"type":"LineString","coordinates":[[6.13264,45.93741],[6.13257,45.93742]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"107"},"geometry":{"type":"LineString","coordinates":[[6.13257,45.93729],[6.13257,45.93725]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"1"},"geometry":{"type":"LineString","coordinates":[[6.13271,45.93771],[6.13268,45.93775]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"120"},"geometry":{"type":"LineString","coordinates":[[6.13216,45.93697],[6.13211,45.93698]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"122"},"geometry":{"type":"LineString","coordinates":[[6.13215,45.93681],[6.1321,45.93681]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"111"},"geometry":{"type":"LineString","coordinates":[[6.13217,45.93711],[6.13221,45.93711]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"Germain somelier"},"geometry":{"type":"LineString","coordinates":[[6.13324,45.9375],[6.13318,45.93746]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"102"},"geometry":{"type":"LineString","coordinates":[[6.13267,45.93767],[6.13262,45.93767]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"112"},"geometry":{"type":"LineString","coordinates":[[6.13243,45.9373],[6.13243,45.93733]]}},
        {"type":"Feature","properties":{"highway":"footway","foot":"yes","name":"105"},"geometry":{"type":"LineString","coordinates":[[6.13263,45.93731],[6.13268,45.9373]]}},

      ]
    };


    var CheminEtage2 = {
      "type": "FeatureCollection",
        "features":[
        {"type":"Feature","properties":{"foot":"yes","name":"V7","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13288,45.9375],[6.13285,45.9375]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V19","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13224,45.93712],[6.13218,45.93713]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R2 STS Bâtiment","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13258,45.93754],[6.13265,45.93753]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V3","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13275,45.93766],[6.13266,45.93767]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V10","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13272,45.93744],[6.13264,45.93745]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"Adjoint","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13208,45.93733],[6.13215,45.93735]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R11","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13238,45.93681],[6.13238,45.93679]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R1 STS Bâtiment","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1326,45.93768],[6.13267,45.93768]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"VDI0","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1327,45.93733],[6.13263,45.93734]]}},
        {"type":"Feature","properties":{"layer":"-2","highway":"footway","tunnel":"yes","name":"V11","foot":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13272,45.93736],[6.13263,45.93736]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R6","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13206,45.93689],[6.13215,45.93688]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V4","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13273,45.9376],[6.13266,45.93759]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V17","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13237,45.93725],[6.13238,45.93729]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V20","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13223,45.9371],[6.13217,45.9371]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"Dessin GC - R3","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13229,45.93736],[6.13228,45.9373]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R11","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13219,45.93682],[6.13219,45.9368]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V1","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13259,45.93777],[6.13262,45.93777]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"2","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13211,45.9373],[6.13216,45.93733]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R8","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13211,45.93678],[6.13213,45.9368]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V2","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13272,45.9378],[6.13268,45.93775]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R7","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13207,45.93684],[6.13214,45.93684]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V9","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13272,45.93747],[6.13264,45.93748]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V21","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13219,45.93702],[6.1322,45.93704]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V5","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1328,45.93758],[6.13279,45.93753]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"GC Profs","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13247,45.93733],[6.1325,45.93731]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R9","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13224,45.93676],[6.13225,45.93679]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V18","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13223,45.9372],[6.13221,45.93717]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V15","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13259,45.93725],[6.13259,45.93728]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V8","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13279,45.9375],[6.13279,45.93753]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R5","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13209,45.93703],[6.13216,45.93702]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V6","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13288,45.93756],[6.13286,45.93756]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"R4","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1321,45.93716],[6.13218,45.93715]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"Coordinateur secteurs","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13219,45.93738],[6.13217,45.93736]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V16","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13245,45.93726],[6.13246,45.93729]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V14","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13262,45.93723],[6.13266,45.93726]]}},
        {"type":"Feature","properties":{"foot":"yes","name":"V13","highway":"footway","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13272,45.93727],[6.13266,45.93726]]}},
        {"type":"Feature","properties":{"name":"E15","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.131,45.93756],[6.131,45.93752]]}},
        {"type":"Feature","properties":{"name":"M2.3","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13156,45.93717],[6.13156,45.93713]]}},
        {"type":"Feature","properties":{"name":"M19","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13172,45.93691],[6.13159,45.93689]]}},
        {"type":"Feature","properties":{"name":"E9","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13137,45.93735],[6.13136,45.93733]]}},
        {"type":"Feature","properties":{"name":"M16 Prof","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13144,45.93668],[6.13144,45.93669],[6.13144,45.93672]]}},
        {"type":"Feature","properties":{"name":"E4","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13172,45.93744],[6.13172,45.9374]]}},
        {"type":"Feature","properties":{"name":"E17","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13105,45.93731],[6.13118,45.9373]]}},
        {"type":"Feature","properties":{"name":"M8","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13103,45.93704],[6.1311,45.93704]]}},
        {"type":"Feature","properties":{"name":"M2","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13158,45.93706],[6.1316,45.93701]]}},
        {"type":"Feature","properties":{"name":"E2","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13178,45.93738],[6.1318,45.93735]]}},
        {"type":"Feature","properties":{"name":"E11","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13125,45.93739],[6.13119,45.9374]]}},
        {"type":"Feature","properties":{"name":"M6","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13126,45.93699],[6.13126,45.93701]]}},
        {"type":"Feature","properties":{"name":"M12","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13158,45.93669],[6.13159,45.93673]]}},
        {"type":"Feature","properties":{"name":"M2.2","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13164,45.93717],[6.13163,45.93712]]}},
        {"type":"Feature","properties":{"name":"E3","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1316,45.93733],[6.13165,45.93731]]}},
        {"type":"Feature","properties":{"name":"M13","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1315,45.9367],[6.1315,45.93674]]}},
        {"type":"Feature","properties":{"name":"M2.5","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13143,45.93708],[6.13143,45.93705]]}},
        {"type":"Feature","properties":{"name":"M17","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13177,45.93692],[6.13172,45.93691]]}},
        {"type":"Feature","properties":{"name":"M14","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13138,45.93673],[6.13144,45.93673]]}},
        {"type":"Feature","properties":{"name":"M1.4","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13113,45.93712],[6.13113,45.93704]]}},
        {"type":"Feature","properties":{"name":"M2.1 Prof","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13176,45.93723],[6.1317,45.93723]]}},
        {"type":"Feature","properties":{"name":"M1.3","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13116,45.93724],[6.13117,45.93729]]}},
        {"type":"Feature","properties":{"name":"Entretien","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1314,45.93732],[6.13136,45.93732]]}},
        {"type":"Feature","properties":{"name":"12","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13119,45.93749],[6.13117,45.93747]]}},
        {"type":"Feature","properties":{"name":"M9","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13156,45.93686],[6.13146,45.93687]]}},
        {"type":"Feature","properties":{"name":"E1","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13178,45.93738],[6.1318,45.93735]]}},
        {"type":"Feature","properties":{"name":"E10 Entretien atelier","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13126,45.93734],[6.13125,45.93729]]}},
        {"type":"Feature","properties":{"name":"M11 Prof","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13167,45.93669],[6.13167,45.93673]]}},
        {"type":"Feature","properties":{"name":"E16","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1309,45.93752],[6.13086,45.93752]]}},
        {"type":"Feature","properties":{"name":"M4","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13173,45.93703],[6.13168,45.93704]]}},
        {"type":"Feature","properties":{"name":"Magasin","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13131,45.93732],[6.13136,45.93732]]}},
        {"type":"Feature","properties":{"name":"13","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13109,45.9374],[6.13104,45.9374]]}},
        {"type":"Feature","properties":{"name":"E6","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13148,45.93732],[6.13148,45.93727]]}},
        {"type":"Feature","properties":{"name":"M16","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13136,45.9367],[6.13144,45.93669]]}},
        {"type":"Feature","properties":{"name":"E14","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13102,45.93736],[6.13103,45.93736],[6.13107,45.93736]]}},
        {"type":"Feature","properties":{"name":"M7","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13117,45.93696],[6.13118,45.93704]]}},
        {"type":"Feature","properties":{"name":"M20","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13164,45.93677],[6.13164,45.93673]]}},
        {"type":"Feature","properties":{"name":"E5","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13166,45.9374],[6.13172,45.93739]]}},
        {"type":"Feature","properties":{"name":"M5 Prof","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13131,45.93697],[6.13131,45.93699]]}},
        {"type":"Feature","properties":{"name":"M2.4","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.1315,45.93716],[6.1315,45.93714]]}},
        {"type":"Feature","properties":{"name":"E7","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13145,45.93732],[6.13145,45.93728]]}},
        {"type":"Feature","properties":{"name":"M18","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13175,45.93673],[6.1317,45.93673]]}},
        {"type":"Feature","properties":{"name":"M1","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13132,45.93716],[6.13125,45.93716]]}},
        {"type":"Feature","properties":{"name":"E15","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.131,45.93756],[6.131,45.93752]]}},
        {"type":"Feature","properties":{"name":"M2.3","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13156,45.93717],[6.13156,45.93713]]}},
        {"type":"Feature","properties":{"name":"M19","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13172,45.93691],[6.13159,45.93689]]}},
        {"type":"Feature","properties":{"name":"M3","highway":"footway","foot":"yes","layer":"-2","tunnel":"yes"},"geometry":{"type":"LineString","coordinates":[[6.13175,45.93719],[6.1317,45.93719]]}},
]};


// Fonction pour basculer entre les thèmes
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const toggleButton = document.getElementById('dark-mode-toggle');
    
    // Vérifier si le mode sombre est activé
    if (document.body.classList.contains('dark-mode')) {
        map.removeLayer(lightMap);
        map.addLayer(darkMap);
        
        // Changer l'icône à partir de l'image dans le dossier ./images
        toggleButton.innerHTML = '<img src="./images/light-icon.png" alt="Mode clair" class="theme-icon"/>'; // Remplacez par votre icône de soleil
    } else {
        map.removeLayer(darkMap);
        map.addLayer(lightMap);
        
        // Changer l'icône à partir de l'image dans le dossier ./images
        toggleButton.innerHTML = '<img src="./images/dark-icon.png" alt="Mode sombre" class="theme-icon"/>'; // Remplacez par votre icône de lune
    }
}


      // Détecter le thème préféré de l'utilisateur
      const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

      if (prefersDarkScheme.matches) {
          document.body.classList.add('dark-mode');
          const toggleButton = document.getElementById('dark-mode-toggle');
          toggleButton.innerHTML = '<img src="./images/light-icon.png" alt="Mode clair" class="theme-icon"/>'; // Icône du soleil
          map.removeLayer(lightMap);
          map.addLayer(darkMap);
      } else {
          document.body.classList.remove('dark-mode');
          const toggleButton = document.getElementById('dark-mode-toggle');
          toggleButton.innerHTML = '<img src="./images/dark-icon.png" alt="Mode sombre" class="theme-icon"/>'; // Icône de la lune
          map.removeLayer(darkMap);
          map.addLayer(lightMap);
      }


      // Ajouter l'événement de clic pour le bouton de basculement
      document.getElementById('dark-mode-toggle').addEventListener('click', toggleTheme);

      // --- 3. Création des couches GeoJSON pour les salles ---
      // On n'utilise plus bindTooltip ici afin d'éviter que le label s'affiche automatiquement au survol.
      function onEachSalleFeature(feature, layer, floor) {
        feature.properties.floor = floor;
        // Pour l'étage 1, si la propriété "name" est absente, on la copie depuis "salle"
        if (
          floor === "1" &&
          !feature.properties.name &&
          feature.properties.salle
        ) {
          feature.properties.name = feature.properties.salle;
        }
        layer.on({
          mouseover: function (e) {
            e.target.setStyle({
              fillOpacity: 1,
              weight: 3,
            });
          },
          mouseout: function (e) {
            if (floor === "0") {
              salleLayer0.resetStyle(e.target);
            } else if (floor === "1") {
              salleLayer1.resetStyle(e.target);
            } else if (floor === "2") {
              salleLayer2.resetStyle(e.target);
            }
          },
          click: function (e) {
            // Supprimer l'appel à resetHighlight() pour conserver les labels
            // Zoom sur la feature cliquée
            map.fitBounds(e.target.getBounds());
          },
        });
      }

      var salleLayer0 = L.geoJSON(salleEtage0, {
        style: function (feature) {
          return { color: "#146414", weight: 2, fillOpacity: 0.9 };
        },
        onEachFeature: function (feature, layer) {
          onEachSalleFeature(feature, layer, "0");
        },
      });

      var salleLayer1 = L.geoJSON(salleEtage1, {
        style: function (feature) {
          return { color: "#2B942B", weight: 2, fillOpacity: 0.9 };
        },
        onEachFeature: function (feature, layer) {
          onEachSalleFeature(feature, layer, "1");
        },
      });

      var salleLayer2 = L.geoJSON(salleEtage2, {
        style: function (feature) {
          return { color: "#093209", weight: 2, fillOpacity: 0.9 }; // modifiez la couleur au besoin
        },
        onEachFeature: function (feature, layer) {
          onEachSalleFeature(feature, layer, "2");
        },
      });

      // --- 4. Calque des chemins ---

      var CheminEtageLayer0 = L.geoJSON(CheminEtage0, {
        style: { color: "transparent" },
      });

      var CheminEtageLayer1 = L.geoJSON(CheminEtage1, {
        style: { color: "transparent" },
      });

      var CheminEtageLayer2 = L.geoJSON(CheminEtage2, {
        style: { color: "transparent" },
      });

      // --- 5. Couches d'itinéraire (initialement vides) ---
      var itinéraireEtage0 = { type: "FeatureCollection", features: [] };
      var itinéraireEtage1 = { type: "FeatureCollection", features: [] };
      var itinéraireEtage2 = { type: "FeatureCollection", features: [] };

      var itinéraireLayer0 = L.geoJSON(itinéraireEtage0, {
        style: { color: "#3564FF", weight: 10 },
      });
      var itinéraireLayer1 = L.geoJSON(itinéraireEtage1, {
        style: { color: "#3564FF", weight: 10 },
      });
      var itinéraireLayer2 = L.geoJSON(itinéraireEtage2, {
        style: { color: "#FFA500", weight: 5 },
      });

      // --- 6. Fonds de carte personnalisés pour chaque groupe (en plus du fond par défaut) ---
      var customBackground0 = L.tileLayer(
        "../Données/QGIS/QTiles/etage0/{z}/{x}/{y}.png",
        {
          opacity: 1,
          maxZoom: 23,
        }
      );
      var customBackground1 = L.tileLayer(
        "../Données/QGIS/QTiles/etage1/{z}/{x}/{y}.png",
        {
          opacity: 1,
          maxZoom: 23,
        }
      );
      var customBackground2 = L.tileLayer(
        "../Données/QGIS/QTiles/etage2/{z}/{x}/{y}.png",
        {
          opacity: 1,
          maxZoom: 23,
        }
      );

      // --- 7. Groupes par étage en ajoutant le fond personnalisé dans le groupe ---
      var etage0 = L.layerGroup([
        customBackground0,
        salleLayer0,
        itinéraireLayer0,
        CheminEtageLayer0,
      ]);
      var etage1 = L.layerGroup([
        customBackground1,
        salleLayer1,
        itinéraireLayer1,
        CheminEtageLayer1,
      ]);
      var etage2 = L.layerGroup([
        customBackground2,
        salleLayer2,
        itinéraireLayer2,
        CheminEtageLayer2,
      ]);
      // Par défaut, le groupe de l'étage 0 est affiché.
      etage0.addTo(map);

      // --- 8. Gestion des labels (tooltips) en fonction du niveau de zoom ---
      const tooltipZoomThreshold = 20; // Seuil de zoom pour afficher les labels
      const arrowZoomThreshold = 20; // Seuil de zoom pour afficher les flèches

      function updateTooltipsVisibility() {
        var currentZoom = map.getZoom();

        function toggleTooltips(layerGroup) {
          layerGroup.eachLayer(function (layer) {
            if (currentZoom >= tooltipZoomThreshold) {
              if (!layer._customTooltip) {
                var labelContent =
                  layer.feature.properties.name ||
                  layer.feature.properties.salle;
                if (labelContent) {
                  var center = layer.getBounds().getCenter();
                  var tooltip = L.tooltip({
                    permanent: true,
                    direction: "center",
                    className: "room-label",
                  })
                    .setContent(labelContent)
                    .setLatLng(center);
                  tooltip.addTo(map);
                  layer._customTooltip = tooltip;
                }
              }
            } else if (layer._customTooltip) {
              map.removeLayer(layer._customTooltip);
              layer._customTooltip = null;
            }
          });
        }

        // Etage 0
        if (map.hasLayer(etage0)) {
          toggleTooltips(salleLayer0);
        } else {
          salleLayer0.eachLayer(function (layer) {
            if (layer._customTooltip) {
              map.removeLayer(layer._customTooltip);
              layer._customTooltip = null;
            }
          });
        }

        // Etage 1
        if (map.hasLayer(etage1)) {
          toggleTooltips(salleLayer1);
        } else {
          salleLayer1.eachLayer(function (layer) {
            if (layer._customTooltip) {
              map.removeLayer(layer._customTooltip);
              layer._customTooltip = null;
            }
          });
        }

        // Etage 2
        if (map.hasLayer(etage2)) {
          toggleTooltips(salleLayer2);
        } else {
          salleLayer2.eachLayer(function (layer) {
            if (layer._customTooltip) {
              map.removeLayer(layer._customTooltip);
              layer._customTooltip = null;
            }
          });
        }

        updateArrowsVisibility();
        updateButtonsVisibility();
      }

      function updateArrowsVisibility() {
        var currentZoom = map.getZoom();
      
        function toggleArrows(layerGroup) {
          var arrowLayers = [];
          layerGroup.eachLayer(function (layer) {
            if (layer instanceof L.PolylineDecorator) {
              if (currentZoom >= arrowZoomThreshold) {
                if (!map.hasLayer(layer)) {
                  arrowLayers.push(layer);
                }
              } else {
                if (map.hasLayer(layer)) {
                  map.removeLayer(layer);
                }
              }
            }
            });
          // Add arrow layers after all polylines have been added
          arrowLayers.forEach((arrow) => {
            map.addLayer(arrow);
            arrow.bringToFront(); // Ensure the arrow is on top
          });
        }
      
        if (map.hasLayer(etage0)) {
          toggleArrows(itinéraireLayer0);
        } else {
          itinéraireLayer0.eachLayer(function (layer) {
            if (layer instanceof L.PolylineDecorator && map.hasLayer(layer)) {
              map.removeLayer(layer);
            }
          });
        }
      
        if (map.hasLayer(etage1)) {
          toggleArrows(itinéraireLayer1);
        } else {
          itinéraireLayer1.eachLayer(function (layer) {
            if (layer instanceof L.PolylineDecorator && map.hasLayer(layer)) {
              map.removeLayer(layer);
            }
          });
        }
      
        if (map.hasLayer(etage2)) {
          toggleArrows(itinéraireLayer2);
        } else {
          itinéraireLayer2.eachLayer(function (layer) {
            if (layer instanceof L.PolylineDecorator && map.hasLayer(layer)) {
              map.removeLayer(layer);
            }
          });
        }
      }
      
// --- Nouvelle fonctionnalité : Boutons sur les formes GeoJSON ---
const buttonZoomThreshold = 21; // Seuil de zoom pour afficher les boutons

function updateButtonsVisibility() {
  var currentZoom = map.getZoom();

  function toggleButtons(layerGroup) {
    layerGroup.eachLayer(function (layer) {
      if (currentZoom >= buttonZoomThreshold) {
        if (!layer._customButton) {
          var center = layer.getBounds().getCenter();
          var btnMarker = L.marker(center, {
            icon: L.divIcon({
              html: '<div style="display: flex; flex-direction: column; align-items: center; line-height: 0;"><button class="custom-geojson-button"><img src="./images/starticon.png" alt="Start Icon" style="width: 16px; height: 16px; margin-right: 5px; box-shadow: 0 40px 80px rgba(0, 0, 0, 1);">Start</button><br><button class="custom-geojson-button"><img src="./images/endicon.png" alt="End Icon" style="width: 16px; height: 16px; margin-right: 5px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">End</button></div>',
              className: '', // Pas de class supplémentaire ici
              iconSize: [30, 60],
              iconAnchor: [15, -15], // Adjusted to move the buttons below the labels
            }),
            interactive: true
          }).addTo(map);

          // Gestion du clic sur le bouton "Start"
          btnMarker.on("click", function (e) {
            if (e.originalEvent.target.innerText === "Start") {
              // Supprimer le précédent point de départ s'il existe
              if (startPoint) {
                map.removeLayer(startPoint);
                startPoint = null;
              }
              // Récupérer le nom et l'étage de la salle associée
              var key = layer.feature.properties.name || layer.feature.properties.salle;
              var floor = layer.feature.properties.floor;
              
              // Rechercher dans la couche active toutes les formes correspondant au même nom
              var matchingFeatures = [];
              var activeLayer = map.hasLayer(etage0)
                ? salleLayer0
                : map.hasLayer(etage1)
                ? salleLayer1
                : salleLayer2;
              activeLayer.eachLayer(function (l) {
                var lKey = l.feature.properties.name || l.feature.properties.salle;
                if (lKey === key) {
                  matchingFeatures.push(l);
                }
              });
              if (matchingFeatures.length > 0) {
                var group = L.featureGroup(matchingFeatures);
                map.fitBounds(group.getBounds());
                matchingFeatures.forEach(function (l) {
                  highlightFeature(l);
                });
              }
              
              // Sélectionner le calque chemin correspondant à l'étage
              var cheminLayer =
                floor === "0"
                  ? CheminEtageLayer0
                  : floor === "1"
                  ? CheminEtageLayer1
                  : CheminEtageLayer2;
              var cheminFeature = null;
              cheminLayer.eachLayer(function (clayer) {
                var clayerKey = clayer.feature.properties.name || clayer.feature.properties.salle;
                if (clayer.feature && clayerKey === key) {
                  cheminFeature = clayer;
                }
              });
              if (cheminFeature) {
                var centerChemin = cheminFeature.getBounds().getCenter();
                startPoint = L.marker(centerChemin, { icon: StartIcon, floor: floor })
                  .addTo(map)
                  .bindPopup(
                    "Point de départ sur le chemin de " + key,
                    { autoPan: false }
                  )
                  .openPopup();
              }
              updateMarkersVisibility();
              checkAndCalculateRoute();
            }
          });

          // Gestion du clic sur le bouton "End"
          btnMarker.on("click", function (e) {
            if (e.originalEvent.target.innerText === "End") {
              // Supprimer le précédent point d'arrivée s'il existe
              if (endPoint) {
                map.removeLayer(endPoint);
                endPoint = null;
              }
              // Récupérer le nom et l'étage de la salle associée
              var key = layer.feature.properties.name || layer.feature.properties.salle;
              var floor = layer.feature.properties.floor;
              
              // Rechercher dans la couche active toutes les formes correspondant au même nom
              var matchingFeatures = [];
              var activeLayer = map.hasLayer(etage0)
                ? salleLayer0
                : map.hasLayer(etage1)
                ? salleLayer1
                : salleLayer2;
              activeLayer.eachLayer(function (l) {
                var lKey = l.feature.properties.name || l.feature.properties.salle;
                if (lKey === key) {
                  matchingFeatures.push(l);
                }
              });
              if (matchingFeatures.length > 0) {
                var group = L.featureGroup(matchingFeatures);
                map.fitBounds(group.getBounds());
                matchingFeatures.forEach(function (l) {
                  highlightFeature(l);
                });
              }
              
              // Sélectionner le calque chemin correspondant à l'étage
              var cheminLayer =
                floor === "0"
                  ? CheminEtageLayer0
                  : floor === "1"
                  ? CheminEtageLayer1
                  : CheminEtageLayer2;
              var cheminFeature = null;
              cheminLayer.eachLayer(function (clayer) {
                var clayerKey = clayer.feature.properties.name || clayer.feature.properties.salle;
                if (clayer.feature && clayerKey === key) {
                  cheminFeature = clayer;
                }
              });
              if (cheminFeature) {
                var centerChemin = cheminFeature.getBounds().getCenter();
                endPoint = L.marker(centerChemin, { icon: EndIcon, floor: floor })
                  .addTo(map)
                  .bindPopup(
                    "Point d'arrivée sur le chemin de " + key,
                    { autoPan: false }
                  )
                  .openPopup();
              }
              updateMarkersVisibility();
              checkAndCalculateRoute();
            }
          });

          layer._customButton = btnMarker;
        }
      } else if (layer._customButton) {
        map.removeLayer(layer._customButton);
        layer._customButton = null;
      }
    });
  }

  // Appliquer selon l'étage actif
  if (map.hasLayer(etage0)) {
    toggleButtons(salleLayer0);
  } else {
    salleLayer0.eachLayer(function (layer) {
      if (layer._customButton) {
        map.removeLayer(layer._customButton);
        layer._customButton = null;
      }
    });
  }

  if (map.hasLayer(etage1)) {
    toggleButtons(salleLayer1);
  } else {
    salleLayer1.eachLayer(function (layer) {
      if (layer._customButton) {
        map.removeLayer(layer._customButton);
        layer._customButton = null;
      }
    });
  }

  if (map.hasLayer(etage2)) {
    toggleButtons(salleLayer2);
  } else {
    salleLayer2.eachLayer(function (layer) {
      if (layer._customButton) {
        map.removeLayer(layer._customButton);
        layer._customButton = null;
      }
    });
  }
}

      map.on("zoomend", updateTooltipsVisibility);
            // Listen for layer changes and update tooltips
            map.on("baselayerchange", function (e) {
        updateTooltipsVisibility();
        updateMarkersVisibility();
        updateArrowsVisibility();
      });

      map.on("zoomend", function () {
        updateTooltipsVisibility();
        updateButtonsVisibility();
      });

      map.on("baselayerchange", function (e) {
        updateTooltipsVisibility();
        updateMarkersVisibility();
        updateArrowsVisibility();
        updateButtonsVisibility(); // Add this line to update buttons visibility on layer change
      });

      // --- 9. Basculement automatique du calque en fonction de la salle recherchée ---
      // Fonction pour vérifier si une salle existe sur le calque actif
      function salleExistsOnActiveLayer(salleName) {
  // Si le nom recherché n'est pas valide, retourner false pour forcer le basculement
  if (!salleName || salleName === "null") {
    return false;
  }
  var activeLayer = null;
  if (map.hasLayer(etage0)) {
    activeLayer = salleLayer0;
  } else if (map.hasLayer(etage1)) {
    activeLayer = salleLayer1;
  } else if (map.hasLayer(etage2)) {
    activeLayer = salleLayer2;
  }
  if (activeLayer) {
    var exists = false;
    activeLayer.eachLayer(function (layer) {
      var layerKey = layer.feature.properties.name || layer.feature.properties.salle;
      // Ne pas tenir compte des noms invalides
      if (!layerKey || layerKey === "null") {
        return;
      }
      if (layerKey === salleName) {
        exists = true;
      }
    });
    return exists;
  }
  return false;
}

      // Modifiez la fonction switchFloor pour utiliser la vérification et effectuer le zoom
      function switchFloor(floor, salleName) {
  // Supprime tous les tooltips personnalisés pour tous les calques
  salleLayer0.eachLayer(function (layer) {
    if (layer._customTooltip) {
      map.removeLayer(layer._customTooltip);
      layer._customTooltip = null;
    }
  });
  salleLayer1.eachLayer(function (layer) {
    if (layer._customTooltip) {
      map.removeLayer(layer._customTooltip);
      layer._customTooltip = null;
    }
  });
  salleLayer2.eachLayer(function (layer) {
    if (layer._customTooltip) {
      map.removeLayer(layer._customTooltip);
      layer._customTooltip = null;
    }
  });

  // Vérifiez si la salle existe sur le calque actif
  if (salleExistsOnActiveLayer(salleName)) {
    updateTooltipsVisibility();
    updateMarkersVisibility();
    return;
  }

  // Basculement du calque visible
  if (floor === "0") {
    if (!map.hasLayer(etage0)) {
      map.addLayer(etage0);
    }
    if (map.hasLayer(etage1)) {
      map.removeLayer(etage1);
    }
    if (map.hasLayer(etage2)) {
      map.removeLayer(etage2);
    }
  } else if (floor === "1") {
    if (!map.hasLayer(etage1)) {
      map.addLayer(etage1);
    }
    if (map.hasLayer(etage0)) {
      map.removeLayer(etage0);
    }
    if (map.hasLayer(etage2)) {
      map.removeLayer(etage2);
    }
  } else if (floor === "2") {
    if (!map.hasLayer(etage2)) {
      map.addLayer(etage2);
    }
    if (map.hasLayer(etage0)) {
      map.removeLayer(etage0);
    }
    if (map.hasLayer(etage1)) {
      map.removeLayer(etage1);
    }
  }

  // Assurez-vous que les flèches sont ajoutées après les segments de l'itinéraire
  updateTooltipsVisibility();
  updateMarkersVisibility();
  updateArrowsVisibility();
  updateButtonsVisibility();
}

      var StartIcon = L.icon({
        iconUrl: "images/starticon.png",

        iconSize: [15, 15], // size of the icon
        iconAnchor: [7.5, 7.5], // point of the icon which will correspond to marker's location
        popupAnchor: [0, -10], // point from which the popup should open relative to the iconAnchor
        pane: "markerPane", // Ensure the icon is added to the markerPane
      });

      var EndIcon = L.icon({
        iconUrl: "images/endicon.png",

        iconSize: [15, 15], // size of the icon
        iconAnchor: [7.5, 7.5], // point of the icon which will correspond to marker's location
        popupAnchor: [0, -10], // point from which the popup should open relative to the iconAnchor
        pane: "markerPane", // Ensure the icon is added to the markerPane
      });

      // --- 10. Variables pour la gestion des marqueurs de départ et d'arrivée ---
      var startPoint = null;
      var endPoint = null;

      // --- 11. Fonctions de surlignage (pour les recherches) ---
      function highlightFeature(layer) {
        layer.setStyle({ weight: 3, fillOpacity: 0.97 });
        layer.bringToFront();
      }
      // Modified resetHighlight function - REPLACE THIS SECTION
      function resetHighlight() {
        [salleLayer0, salleLayer1, salleLayer2].forEach(function (layerGroup) {
          layerGroup.eachLayer(function (layer) {
            layerGroup.resetStyle(layer);
            if (layer._customTooltip) {
              map.removeLayer(layer._customTooltip);
              layer._customTooltip = null;
            }
          });
        });
      }

      // --- 12. Vérification et calcul de l'itinéraire ---
      function checkAndCalculateRoute() {
        if (startPoint && endPoint) {
          var startCoords = [
            startPoint.getLatLng().lat,
            startPoint.getLatLng().lng,
          ];
          var endCoords = [endPoint.getLatLng().lat, endPoint.getLatLng().lng];
          getRouteAndPoints(startCoords, endCoords);
        }
      }

      // --- 13. Barre de recherche pour le marqueur de départ ---
      var searchGroup = L.featureGroup();
      salleLayer0.eachLayer(function (layer) {
        searchGroup.addLayer(layer);
      });
      salleLayer1.eachLayer(function (layer) {
        searchGroup.addLayer(layer);
      });
      // Après avoir ajouté salleLayer0 et salleLayer1 à searchGroup
      salleLayer2.eachLayer(function (layer) {
        searchGroup.addLayer(layer);
      });

      var searchControlStart = new L.Control.Search({
        layer: searchGroup,
        propertyName: "name",
        marker: false,
        collapsed: false,
        moveToLocation: function (latlng, title, map) {
          // Laisser le zoom personnalisé se gérer ailleurs
        },
        position: "topleft",
        textPlaceholder: "Point de départ",
      });
      map.addControl(searchControlStart);
      // Ajout de l'id au container du contrôle start
      searchControlStart.getContainer().id = "search-control-start";
      // Lorsqu'une recherche est ouverte, ajouter un id au tooltip
      searchControlStart.on("search:expanded", function () {
        if (this._tooltip) {
          this._tooltip.id = "search-tooltip-start";
        }
      });

      searchControlStart.on("search:locationfound", function (e) {
        resetHighlight();
        if (startPoint) {
          map.removeLayer(startPoint);
          startPoint = null;
        }
        var salleFeature = e.layer;
        var salleName = salleFeature.feature.properties.name || salleFeature.feature.properties.salle;
        switchFloor(salleFeature.feature.properties.floor, salleName);
        var key = salleName;
        var matchingFeatures = [];
        var activeLayer = map.hasLayer(etage0) ? salleLayer0 : map.hasLayer(etage1) ? salleLayer1 : salleLayer2;
        activeLayer.eachLayer(function (layer) {
          var layerKey = layer.feature.properties.name || layer.feature.properties.salle;
          if (layerKey === key) {
            matchingFeatures.push(layer);
          }
        });
        if (matchingFeatures.length > 0) {
          var group = new L.featureGroup(matchingFeatures);
          map.fitBounds(group.getBounds());
          matchingFeatures.forEach(function (layer) {
            highlightFeature(layer);
          });
          var cheminFeature = null;
          var floor = salleFeature.feature.properties.floor;
          var cheminLayer =
            floor === "0"
              ? CheminEtageLayer0
              : floor === "1"
              ? CheminEtageLayer1
              : CheminEtageLayer2;
          cheminLayer.eachLayer(function (layer) {
            var layerKey =
              layer.feature.properties.name || layer.feature.properties.salle;
            if (layer.feature && layerKey === key) {
              cheminFeature = layer;
            }
          });
          if (cheminFeature) {
            var center = cheminFeature.getBounds().getCenter();
            startPoint = L.marker(center, { icon: StartIcon, floor: floor })
              .addTo(map)
              .bindPopup("Point de départ sur le chemin de " + key, {
                autoPan: false,
              })
              .openPopup();
          }
        }
        updateMarkersVisibility();
        checkAndCalculateRoute();
      });

      // --- 14. Barre de recherche pour le marqueur de fin ---
      var searchControlEnd = new L.Control.Search({
        layer: searchGroup,
        propertyName: "name",
        marker: false,
        collapsed: false,
        moveToLocation: function (latlng, title, map) {
          // Pas d'action ici
        },
        position: "topleft",
        textPlaceholder: "Point d'arrivée",
      });
      map.addControl(searchControlEnd);
      // Ajout de l'id au container du contrôle end
      searchControlEnd.getContainer().id = "search-control-end";
      // Lorsqu'une recherche est ouverte, ajouter un id au tooltip
      searchControlEnd.on("search:expanded", function () {
        if (this._tooltip) {
          this._tooltip.id = "search-tooltip-end";
        }
      });

      searchControlEnd.on("search:locationfound", function (e) {
        resetHighlight();
        if (endPoint) {
          map.removeLayer(endPoint);
          endPoint = null;
        }
        var salleFeature = e.layer;
        var salleName = salleFeature.feature.properties.name || salleFeature.feature.properties.salle;
        switchFloor(salleFeature.feature.properties.floor, salleName);
        var key = salleName;
        var matchingFeatures = [];
        var activeLayer = map.hasLayer(etage0) ? salleLayer0 : map.hasLayer(etage1) ? salleLayer1 : salleLayer2;
        activeLayer.eachLayer(function (layer) {
          var layerKey =
            layer.feature.properties.name || layer.feature.properties.salle;
          if (layerKey === key) {
            matchingFeatures.push(layer);
          }
        });
        if (matchingFeatures.length > 0) {
          var group = new L.featureGroup(matchingFeatures);
          map.fitBounds(group.getBounds());
          matchingFeatures.forEach(function (layer) {
            highlightFeature(layer);
          });
          var cheminFeature = null;
          var floor = salleFeature.feature.properties.floor;
          var cheminLayer =
            floor === "0"
              ? CheminEtageLayer0
              : floor === "1"
              ? CheminEtageLayer1
              : CheminEtageLayer2;
          cheminLayer.eachLayer(function (layer) {
            var layerKey =
              layer.feature.properties.name || layer.feature.properties.salle;
            if (layer.feature && layerKey === key) {
              cheminFeature = layer;
            }
          });
          if (cheminFeature) {
            var center = cheminFeature.getBounds().getCenter();
            endPoint = L.marker(center, { icon: EndIcon, floor: floor })
              .addTo(map)
              .bindPopup("Point de fin sur le chemin de " + key, {
                autoPan: false,
              })
              .openPopup();
          }
        }
        updateMarkersVisibility();
        checkAndCalculateRoute();
      });

      searchControlStart.on("search:expanded", function () {
        if (this._tooltip) {
          this._tooltip.id = "search-tooltip-start";
          this._tooltip.classList.add("search-tooltip-start"); // Ajoute une classe spécifique
          console.log(
            "ID de la tooltip de recherche de départ :",
            this._tooltip.id
          );
        }
      });

      searchControlEnd.on("search:expanded", function () {
        if (this._tooltip) {
          this._tooltip.id = "search-tooltip-end";
          this._tooltip.classList.add("search-tooltip-end"); // Ajoute une classe spécifique
          console.log(
            "ID de la tooltip de recherche de fin :",
            this._tooltip.id
          );
        }
      });

      function getRouteAndPoints(start, end) {
        var osrmUrl = `https://classefinder.duckdns.org/osrm/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?steps=true&geometries=geojson&overview=full`;

        fetch(osrmUrl)
          .then((response) => response.json())
          .then((data) => {
            if (data.routes && data.routes.length > 0) {
              var route = data.routes[0];

              itinéraireLayer0.clearLayers();
              itinéraireLayer1.clearLayers();
              itinéraireLayer2.clearLayers();

              route.legs[0].steps.forEach((step, index) => {
                var startName = step.name || "";
                var segment = {
                  type: "Feature",
                  geometry: {
                    type: "LineString",
                    coordinates: step.geometry.coordinates,
                  },
                  properties: { name: startName },
                };

                var color = "#0031D2";
                var itineraireLayer = itinéraireLayer0;
                if (startName.toLowerCase().includes("1")) {
                  color = "#3564FF";
                  itineraireLayer = itinéraireLayer1;
                } else if (startName.toLowerCase().includes("2")) {
                  color = "#002499";
                  itineraireLayer = itinéraireLayer2;
                }

                var polyline = L.polyline(
                  step.geometry.coordinates.map((coord) => [
                    coord[1],
                    coord[0],
                  ]),
                  {
                    pane: "routePane", // Affecte le polyline au pane "routePane"
                    color: color,
                    weight: 10,
                  }
                );

                var polyline = L.polyline(
                  step.geometry.coordinates.map(coord => [coord[1], coord[0]]),
                  {
                    pane: "routePane",
                    color: color,
                    weight: 10,
                  }
                );

                var arrow = L.polylineDecorator(polyline, {
  pane: "arrowPane",
  patterns: [
    {
      offset: "9s",
      repeat: "50%",
      symbol: L.Symbol.arrowHead({
        pixelSize: 9,
        headAngle: 60,
        polygon: false,
        pathOptions: {
          pane: "arrowPane", // Ajouté ici
          stroke: true,
          color: "white",
          weight: 3,
          fill: false,
          fillOpacity: 1,
        },
      }),
    },
    {
      offset: "0%",
      repeat: "50%",
      symbol: L.Symbol.dash({
        pixelSize: 10,
        pathOptions: {
          pane: "arrowPane", // Ajouté ici
          stroke: true,
          color: "white",
          weight: 3,
          fill: false,
          fillOpacity: 1,
        },
      }),
    },
  ],
});
    itineraireLayer.addLayer(polyline).addLayer(arrow); // Ajoute les deux au groupe
              });

              var bounds = L.geoJSON(route.geometry).getBounds();
              map.fitBounds(bounds);

              updateArrowsVisibility();
            }
          })
          .catch((error) => {
            console.error(
              "Erreur lors de la récupération de l'itinéraire:",
              error
            );
          });
      }

      // --- 16. Contrôle des calques via le sélecteur ---
      var baseLayers = {
        "Étage 1": etage1,
        "Étage 0": etage0,
        "Étage -1": etage2,
      };
      L.control.layers(baseLayers, null, { collapsed: false }).addTo(map);

      // Listen for layer changes and update tooltips
      map.on("baselayerchange", function (e) {
        updateTooltipsVisibility();
        updateMarkersVisibility();
        updateArrowsVisibility();
      });


      map.removeLayer(etage1);

      function updateMarkersVisibility() {
        if (map.hasLayer(etage0)) {
          if (startPoint && startPoint.options.floor !== "0") {
            map.removeLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor !== "0") {
            map.removeLayer(endPoint);
          }
          if (startPoint && startPoint.options.floor === "0") {
            map.addLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor === "0") {
            map.addLayer(endPoint);
          }
        } else if (map.hasLayer(etage1)) {
          if (startPoint && startPoint.options.floor !== "1") {
            map.removeLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor !== "1") {
            map.removeLayer(endPoint);
          }
          if (startPoint && startPoint.options.floor === "1") {
            map.addLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor === "1") {
            map.addLayer(endPoint);
          }
        } else if (map.hasLayer(etage2)) {
          if (startPoint && startPoint.options.floor !== "2") {
            map.removeLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor !== "2") {
            map.removeLayer(endPoint);
          }
          if (startPoint && startPoint.options.floor === "2") {
            map.addLayer(startPoint);
          }
          if (endPoint && endPoint.options.floor === "2") {
            map.addLayer(endPoint);
          }
        }
      }

      // Fonction de cycle des calques au démarrage
      function cycleLayers() {
        // Afficher étage 0 immédiatement
        switchFloor("0");
        // Après 3 secondes, afficher étage 1
        setTimeout(function () {
          switchFloor("1");
          // Après 3 secondes supplémentaires, afficher étage 2
          setTimeout(function () {
            switchFloor("2");
            setTimeout(function () {
              switchFloor("0");
            }, 1);
          }, 1);
        }, 1);
      }

      // Appeler la fonction lors du chargement du site
      cycleLayers();
    </script>
  </body>
</html>
